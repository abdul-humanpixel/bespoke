<!doctype html>

<head>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">

    <style>
        .presentation_on {
            display: block;
        }
        .participant_uri {
            display: inline-block;
            padding: 0.2em;
            background-color: none;
        }
        .participant_uri_speaking {
            display: inline-block;
            padding: 0.2em;
            background-color: lightgrey;
        }

        .roster_list {
            list-style-type: none;
            display: inline-block;
            width: 32em;
            float: left;
            text-align: center;
            /* border: 1px solid; */
            padding: 10px 10px;
        }
        .roster_entry {
            text-align: left;
            border:1px solid gray;
            padding: 3px;
            margin: 3px;
        }
        .participant_action {
            /*padding: 0.2em;*/
        }
        .conference_action {
            display: inline-block;
            /* float: left; */
            /*padding: 1em;*/
        }
        .hide {
            display: none;
        }

        body {
        padding: 5px;
        }

        .currentoverlaytext {
        background-color: #000000;
        color: #FFFFFF;
        border: 0px;
        padding: 2px;
        text-align:center;
        }
        .clabel{
            display: inline-block;
            float: left;
            clear: left;
            width: 170px;
            text-align: left;
            font-weight: bold;
            padding-right: 5px;
        }
        .cinput {
        display: inline-block;
        float: left;
        }

        .ia {
        display: inline-block;
        float: left;
        }

        #fixed-div {
            position: fixed;
            top: 1em;
            right: 1em;
        }

        .colcontainer{
        column-count: 2;
        column-gap: 20px;
        -moz-column-count: 2;
        -moz-column-gap: 20px;
        -webkit-column-count: 2;
        -webkit-column-gap: 20px;
        }

        .green {
        color:#198b16;
        }
        .pexorange {
        color:#F28630;
        }

        .red {
        color:#FF0000;
        }

        .yellow {
        color:#FFDB00;
        }

        .disabled_action {
            color: lightgrey;
        }

        .chatbox {
            font-family:tahoma;
            font-size:12px;
            color:black;
            border: 1px teal solid;
            height: 225px;
            width: 100%;
            overflow: scroll;
            float:left;
        }

        .message {
        }

        .message_origin {
            background-color: lightgrey;
            /*display: inline-block;*/
            /*padding-right: 3px;*/
        }

        #layout_canvas {
            border: 1px solid black;
        }

        .autocomplete-suggestions {
            text-align: left; cursor: default; border: 1px solid #ccc; border-top: 0; background: #fff; box-shadow: -1px 1px 3px rgba(0,0,0,.1);

            /* core styles should not be changed */
            position: absolute; display: none; z-index: 9999; max-height: 254px; overflow: hidden; overflow-y: auto; box-sizing: border-box;
        }
        .autocomplete-suggestion { position: relative; padding: 0 .6em; line-height: 23px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 1.02em; color: #333; }
        .autocomplete-suggestion b { font-weight: normal; color: #1f8dd6; }
        .autocomplete-suggestion.selected { background: #f0f0f0; }

        .infomodal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        padding-top: 100px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        .infomodal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 300px;
        }

        .infomodal-content-list {
            list-style-type: none;
        }

        /* The Close Button */
        .infomodal-close {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        }

        .infomodal-close:hover,
        .infomodal-close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
        }
    </style>

    <script>
    // JavaScript autoComplete v1.0.4
    // https://github.com/Pixabay/JavaScript-autoComplete
    var autoComplete=function(){function e(e){function t(e,t){return e.classList?e.classList.contains(t):new RegExp("\\b"+t+"\\b").test(e.className)}function o(e,t,o){e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener(t,o)}function s(e,t,o){e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener(t,o)}function n(e,s,n,l){o(l||document,s,function(o){for(var s,l=o.target||o.srcElement;l&&!(s=t(l,e));)l=l.parentElement;s&&n.call(l,o)})}if(document.querySelector){var l={selector:0,source:0,minChars:3,delay:150,offsetLeft:0,offsetTop:1,cache:1,menuClass:"",renderItem:function(e,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var o=new RegExp("("+t.split(" ").join("|")+")","gi");return'<div class="autocomplete-suggestion" data-val="'+e+'">'+e.replace(o,"<b>$1</b>")+"</div>"},onSelect:function(){}};for(var c in e)e.hasOwnProperty(c)&&(l[c]=e[c]);for(var a="object"==typeof l.selector?[l.selector]:document.querySelectorAll(l.selector),u=0;u<a.length;u++){var i=a[u];i.sc=document.createElement("div"),i.sc.className="autocomplete-suggestions "+l.menuClass,i.autocompleteAttr=i.getAttribute("autocomplete"),i.setAttribute("autocomplete","off"),i.cache={},i.last_val="",i.updateSC=function(e,t){var o=i.getBoundingClientRect();if(i.sc.style.left=Math.round(o.left+(window.pageXOffset||document.documentElement.scrollLeft)+l.offsetLeft)+"px",i.sc.style.top=Math.round(o.bottom+(window.pageYOffset||document.documentElement.scrollTop)+l.offsetTop)+"px",i.sc.style.width=Math.round(o.right-o.left)+"px",!e&&(i.sc.style.display="block",i.sc.maxHeight||(i.sc.maxHeight=parseInt((window.getComputedStyle?getComputedStyle(i.sc,null):i.sc.currentStyle).maxHeight)),i.sc.suggestionHeight||(i.sc.suggestionHeight=i.sc.querySelector(".autocomplete-suggestion").offsetHeight),i.sc.suggestionHeight))if(t){var s=i.sc.scrollTop,n=t.getBoundingClientRect().top-i.sc.getBoundingClientRect().top;n+i.sc.suggestionHeight-i.sc.maxHeight>0?i.sc.scrollTop=n+i.sc.suggestionHeight+s-i.sc.maxHeight:0>n&&(i.sc.scrollTop=n+s)}else i.sc.scrollTop=0},o(window,"resize",i.updateSC),document.body.appendChild(i.sc),n("autocomplete-suggestion","mouseleave",function(){var e=i.sc.querySelector(".autocomplete-suggestion.selected");e&&setTimeout(function(){e.className=e.className.replace("selected","")},20)},i.sc),n("autocomplete-suggestion","mouseover",function(){var e=i.sc.querySelector(".autocomplete-suggestion.selected");e&&(e.className=e.className.replace("selected","")),this.className+=" selected"},i.sc),n("autocomplete-suggestion","mousedown",function(e){if(t(this,"autocomplete-suggestion")){var o=this.getAttribute("data-val");i.value=o,l.onSelect(e,o,this),i.sc.style.display="none"}},i.sc),i.blurHandler=function(){try{var e=document.querySelector(".autocomplete-suggestions:hover")}catch(t){var e=0}e?i!==document.activeElement&&setTimeout(function(){i.focus()},20):(i.last_val=i.value,i.sc.style.display="none",setTimeout(function(){i.sc.style.display="none"},350))},o(i,"blur",i.blurHandler);var r=function(e){var t=i.value;if(i.cache[t]=e,e.length&&t.length>=l.minChars){for(var o="",s=0;s<e.length;s++)o+=l.renderItem(e[s],t);i.sc.innerHTML=o,i.updateSC(0)}else i.sc.style.display="none"};i.keydownHandler=function(e){var t=window.event?e.keyCode:e.which;if((40==t||38==t)&&i.sc.innerHTML){var o,s=i.sc.querySelector(".autocomplete-suggestion.selected");return s?(o=40==t?s.nextSibling:s.previousSibling,o?(s.className=s.className.replace("selected",""),o.className+=" selected",i.value=o.getAttribute("data-val")):(s.className=s.className.replace("selected",""),i.value=i.last_val,o=0)):(o=40==t?i.sc.querySelector(".autocomplete-suggestion"):i.sc.childNodes[i.sc.childNodes.length-1],o.className+=" selected",i.value=o.getAttribute("data-val")),i.updateSC(0,o),!1}if(27==t)i.value=i.last_val,i.sc.style.display="none";else if(13==t||9==t){var s=i.sc.querySelector(".autocomplete-suggestion.selected");s&&"none"!=i.sc.style.display&&(l.onSelect(e,s.getAttribute("data-val"),s),setTimeout(function(){i.sc.style.display="none"},20))}},o(i,"keydown",i.keydownHandler),i.keyupHandler=function(e){var t=window.event?e.keyCode:e.which;if(!t||(35>t||t>40)&&13!=t&&27!=t){var o=i.value;if(o.length>=l.minChars){if(o!=i.last_val){if(i.last_val=o,clearTimeout(i.timer),l.cache){if(o in i.cache)return void r(i.cache[o]);for(var s=1;s<o.length-l.minChars;s++){var n=o.slice(0,o.length-s);if(n in i.cache&&!i.cache[n].length)return void r([])}}i.timer=setTimeout(function(){l.source(o,r)},l.delay)}}else i.last_val=o,i.sc.style.display="none"}},o(i,"keyup",i.keyupHandler),i.focusHandler=function(e){i.last_val="\n",i.keyupHandler(e)},l.minChars||o(i,"focus",i.focusHandler)}this.destroy=function(){for(var e=0;e<a.length;e++){var t=a[e];s(window,"resize",t.updateSC),s(t,"blur",t.blurHandler),s(t,"focus",t.focusHandler),s(t,"keydown",t.keydownHandler),s(t,"keyup",t.keyupHandler),t.autocompleteAttr?t.setAttribute("autocomplete",t.autocompleteAttr):t.removeAttribute("autocomplete"),document.body.removeChild(t.sc),t=null}}}}return e}();!function(){"function"==typeof define&&define.amd?define("autoComplete",function(){return autoComplete}):"undefined"!=typeof module&&module.exports?module.exports=autoComplete:window.autoComplete=autoComplete}();
    </script>

    <script type="text/javascript" src="/jwplayer/jwplayer.js"></script>

</head>


<title>Pexip APIv2 Example</title>

<body onload="action_request_args()">
    <h2>
        <img src="data:image/png;base64,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"
             height="20px" alt="pexip" hspace="5" onclick="show_info()"/> 
          Client API v2 example
    </h2>
    <div id="myinfomodal" class="infomodal">
        <div class="infomodal-content">
            <span class="infomodal-close" onclick="hide_info()">&times;</span>
            <ul class="infomodal-content-list">
                <li>Disconnect <i class="fa fa-eject fa-fw red"></i></li>
                <li>Muted <div class="fa fa-microphone-slash fa-fw red"></div></li>
                <li>Unmuted <div class="fa fa-microphone fa-fw green"></div></li>
                <li>Hold <div class="fa fa-pause fa-fw"></div></li>
                <li>Resume <div class="fa fa-play fa-fw"></div></li>
                <li>Locked <div class="fa fa-lock fa-fw red"></div></li>
                <li>Unlocked <div class="fa fa-unlock fa-fw green"></div></li>
                <li>Spotlight ON <div class="fa fa-star fa-fw yellow"></div></labliel>
                <li>Spotlight OFF <div class="fa fa-star-o fa-fw yellow"></div></li>
                <li>Allowed to see presentation <div class="fa fa-bar-chart fa-fw green"></div></li>
                <li>Not allowed to see presentation <div class="fa fa-bar-chart fa-fw red"></div></li>
                <li>Chair <div class="fa fa-commenting fa-fw"></div></li>
                <li>Guest <div class="fa fa fa-comment fa-fw"></div></li>
                <li>Buzz ON <div class="fa fa-hand-paper-o grey fa-fw"></div></li>
                <li>Buzz OFF <div class="fa fa fa-hand-paper-o grey fa-rotate-180 fa-fw"></div></li>
            </ul>
        </div>
    </div>

    <div>
    <form id="joinleaveform" onsubmit="return user.join()">
    <label class="clabel">Conference </label><input class="cinput" type="text" id="conference" value="" size=40 /><br/>
    <label class="clabel">Worker </label><input class="cinput" type="text" id="worker" value="" size=40 /><br/>
    <label class="clabel">Pin </label><input class="cinput" type="text" id="pin" value="" size=8 /><br/>
    <label class="clabel">Display name </label><input class="cinput" type="text" id="display_name" value="" size=40 /><br/>
    <label class="clabel">Extension </label><input class="cinput" type="text" id="two_stage_dial_ext" value="" size=40 /><br/>
    <label class="clabel">Start conference if host </label><input class="cinput" type="checkbox" id="start_if_host" /><br/><br/>
    <input class="green cinput" id="joinleave" type="submit" value="Join Conference" /><label id="joinerror" class="red"></label><br/>
    </form>
    </div>
    <br/>

    <div>
    <form>
    <label class="clabel">Alias </label><input class="cinput" type="text" id="reg_alias" value="" size=40 /><br/>
    <label class="clabel">Username </label><input class="cinput" type="text" id="reg_username" value="" size=40 /><br/>
    <label class="clabel">Password </label><input class="cinput" type="password" id="reg_password" value="" size=40 /><br/>
    <label class="clabel">Host </label><input class="cinput" type="text" id="reg_host" value="" size=40 /><br/><br/>
    <input class="green cinput" id="register" type="button" onclick="reg.register()" value="Register" /><label id="regerror" class="red"></label><br/>
    </form>
    </div>
    <br/>

    <div id="confcontrol" class="hide">
        <div id="liveviewdiv" class="hide">
            <fieldset>
            <legend>RTMP</legend>
            <table><tr><td><span id="liveviewplayer"></span></td><td><span id="liveviewpresplayer"></span></td></tr></table>
            <input id="liveview" type="button" onclick="user.liveview()" value="Start live view" />
            <span id="dual_live"><input id="dual_live_sel" type="checkbox" value="dual" />Dual stream</span><br/>
            <input id="getrtmpaddress" type="button" onclick="user.getrtmpaddress()" value="Get RTMP address" />
            <input id="rtmpaddress" size=90 /><br/>
            </fieldset>
        </div>
        <br/>

        <div id="layoutdiv">
            <fieldset>
                <legend>Layout control</legend>
                <label>Actors </label>
                <select id="actors" value="everyone">
                    <option value="everyone">Everyone</option>
                    <option value="selected">Selected</option>
                </select>

                <label>Layout </label>
                <select id="layout" value="1:7">
                    <option value="1:0">1 main 0 pips</option>
                    <option value="4:0">Equal layout</option>
                    <option value="1:7">1 main 7 pips</option>
                    <option value="1:21">1 main 21 pips</option>
                    <option value="2:21">2 mains 21 pips</option>
                </select>

                <label>Remove self </label>
                <input type="checkbox" id="removeself" checked/>

                <label>PlusN (off/auto/n)</label>
                <input id="plusn" list="plusnvalues" value="auto" size=8/>
                <datalist id="plusnvalues">
                    <option id="auto_option" value="auto"\>
                    <option value="off"\>
                </datalist>

                <label>VAD backfill </label>
                <input type="checkbox" id="vadbackfill" checked/>

                <label>Overlay text </label>
                <select id="overlay_text" onchange="update_hostoverlaytext()" value="off">
                    <option value="off">Off</option>
                    <option value="auto">Auto</option>
                    <option value="positional">Positional</option>
                </select>

                <label>Indicators </label>
                <select id="indicators" value="auto">
                    <option value="auto">Auto</option>
                    <option value="off">Off</option>
                </select>

                <label>Audience </label>
                <select id="audience" value="everyone" onchange="update_audience()">
                    <option value="everyone">Everyone</option>
                    <option value="hosts">Hosts</option>
                </select>

                <input id="overridelayout" type="button" onclick="user.overridelayout()" value="Override layout" />
                <input id="resetlayout" type="button" onclick="user.resetlayout()" value="Reset layout" /><br/>

                <div id="hostpositionaltextdiv" class="hide">
                    <label>Positional overlay text (comma separated) </label><input id="hostpositionaltext" type="text" value="" size=90/>
                </div>

                <div id="guestlayout" class="hide">
                    <label>Actors </label>
                    <select id="guest_actors" value="everyone">
                        <option value="everyone">Everyone</option>
                        <option value="selected">Selected</option>
                    </select>

                    <label>Layout </label>
                    <select id="guest_layout" value="1:7">
                        <option value="1:0">1 main 0 pips</option>
                        <option value="4:0">Equal layout</option>
                        <option value="1:7">1 main 7 pips</option>
                        <option value="1:21">1 main 21 pips</option>
                        <option value="2:21">2 mains 21 pips</option>
                    </select>

                    <label>Remove self </label>
                    <input type="checkbox" id="guest_removeself" checked/>

                    <label>PlusN (off/auto/n)</label>
                    <input id="guest_plusn" list="guest_plusnvalues" value="auto" size=8/>
                    <datalist id="guest_plusnvalues">
                        <option value="auto"\><option value="off"\>
                    </datalist>

                    <label>VAD backfill </label>
                    <input type="checkbox" id="guest_vadbackfill" checked/>

                    <label>Overlay text </label>
                    <select id="guest_overlay_text" onchange="update_guestoverlaytext()" value="off">
                        <option value="off">Off</option>
                        <option value="auto">Auto</option>
                        <option value="positional">Positional</option>
                    </select>

                    <label>Indicators </label>
                    <select id="guest_indicators" value="auto">
                        <option value="off">Off</option>
                        <option value="auto">Auto</option>
                    </select>

                    <label>Audience </label>
                    <select id="guest_audience" value="guests">
                        <option value="guests">Guests</option>
                    </select>

                    <div id="guestpositionaltextdiv" class="hide">
                        <label>Positional overlay text (comma separated) </label>
                        <input id="guestpositionaltext" type="text" value="" size=90/>
                    </div>
                </div>
            </fieldset>
        </div>
        <br/>

        <div id="transformdiv">
            <fieldset>
            <legend>Layout Transformation</legend>
            <label>Layout / Host layout </label>
            <select id="tl_layout" value="">
                <option value="">Unset</option>
                <option value="1:0">1 main 0 pips</option>
                <option value="4:0">Equal layout</option>
                <option value="1:7">1 main 7 pips</option>
                <option value="1:21">1 main 21 pips</option>
                <option value="2:21">2 mains 21 pips</option>
            </select>

            <label>Guest layout (lecture mode only) </label>
            <select id="tl_guest_layout" value="">
                <option value="">Unset</option>
                <option value="1:0">1 main 0 pips</option>
                <option value="4:0">Equal layout</option>
                <option value="1:7">1 main 7 pips</option>
                <option value="1:21">1 main 21 pips</option>
                <option value="2:21">2 mains 21 pips</option>
            </select>

            <label>Recording indicator </label>
            <select id="tl_recording" value="">
                <option value="">Unset</option>
                <option value="on">On</option>
                <option value="off">Off</option>
            </select>

            <label>Streaming indicator </label>
            <select id="tl_streaming" value="">
                <option value="">Unset</option>
                <option value="on">On</option>
                <option value="off">Off</option>
            </select>

            <label>Text overlay </label>
            <select id="tl_enable_overlay_text" value="">
                <option value="">Unset</option>
                <option value="on">On</option>
                <option value="off">Off</option>
            </select>

            <input id="transformlayout" type="button" onclick="user.transformlayout()" value="Transform layout" />
            <input id="resettransformlayout" type="button" onclick="user.resettransformlayout()" value="Reset layout transformation" /><br/>

            </fieldset>
        </div>
        <br/>

        <div id="dialdiv">
            <fieldset>
            <legend>Dial out</legend>
            <label>Protocol </label>
            <select id="protocol" value="sip">
                <option value="sip">SIP</option>
                <option value="h323">H.323</option>
                <option value="mssip">Lync</option>
                <option value="rtmp">RTMP</option>
                <option value="rtsp">RTSP</option>
            </select>

            <label>Local alias </label>
            <input id="localalias" type="text" value="" size=15/>

            <label>Local display name </label>
            <input id="localdisplayname" type="text" value="" size=15/>

            <label>Remote alias </label>
            <input id="remotealias" type="text" value="" size=15/>

            <label>Role </label>
            <select id="role" value="guest">
                <option value="guest">Guest</option>
                <option value="host">Host</option>
            </select>

            <input id="dial" type="button" onclick="user.dial()" value="Dial" /><br/>

            <a target="_blank" href="http://yt.pexip.com">Create a remotealias for YouTube streaming</a>
            </fieldset>
        </div>
        <br/>

        <div id="rtspdiv">
            <fieldset>
            <legend>RTSP</legend>
            <input id="rtspaddress" size=90 value="rtsp://wowzaec2demo.streamlock.net/vod/mp4:BigBuckBunny_115k.mov"/><br/>
            <input id="rtspjoin" type="button" onclick="user.rtspjoin()" value="Create RTSP call" />
            <input id="rtspleave" type="button" onclick="user.rtspleave()" value="Destroy RTSP call" disabled="true" />
            </fieldset>
        </div>
        <br/>

        <div id="chatdiv" class="hide">
            <fieldset>
            <legend>Chat</legend>
            <form onsubmit="return user.send_message()">
            <div id="chatbox" class="chatbox"></div><br/>
            <input id="chatinput" type="text" size=200 />
            <input id="chatsend" type="button" onclick="user.send_message()" value="Send"/>
            </form>
            </fieldset>
        </div>
        <br/>

        <img id="presentation" width=400 height=200 class="hide">

        <canvas id="layout_canvas" width=280 height=200>
        </canvas>
        <br/>

        <ul id="waitingroom" class="roster_list">
            <li><b>Waiting Room</b></li>
        </ul>

        <ul id="rosterlist" class="roster_list">
            <li>
                <i id="start_conf" onclick="user.start_conference()"></i>
                <i id="conflock" onclick="user.lock()"></i>
                <i id="guestsmuted" onclick="user.muteallguests()"></i>
                <i id="disconnectall" onclick="user.disconnect_all()"></i>
                <b>Conference</b>
            </li>
        </ul>

        <ul id="buzzing" class="roster_list">
            <li>
                <i id="clearallbuzz" onclick="user.clearallbuzz()"></i>
                <b>Buzzing</b>
            </li>
        </ul>
    </div>
<script>

// className strings
var class_disconnect = "participant_action fa fa-eject fa-fw red";
var class_mute_on = "participant_action fa fa-microphone-slash fa-fw red";
var class_mute_off = "participant_action fa fa-microphone fa-fw green";
var class_hold_on = "participant_action fa fa-play fa-fw";
var class_hold_off = "participant_action fa fa-pause fa-fw";
var class_lock_on = "participant_action fa fa-lock fa-fw red";
var class_spotlight_on = "participant_action fa fa-star fa-fw yellow";
var class_spotlight_off = "participant_action fa fa-star-o fa-fw yellow";
var class_see_presentation_allowed = "participant_action fa fa-bar-chart fa-fw green";
var class_see_presentation_denied = "participant_action fa fa-bar-chart fa-fw red";
var class_overlay = "participant_action fa fa-font fa-fw";
var class_conference_lock_on = "conference_action fa fa-lock fa-fw red";
var class_conference_lock_off = "conference_action fa fa-unlock fa-fw green";
var class_conference_guests_mute_on = "conference_action fa fa-microphone-slash fa-fw red";
var class_conference_guests_mute_off = "conference_action fa fa-microphone fa-fw green";
var class_conference_disconnect_all = "conference_action fa fa-eject fa-fw red";
var class_role_chair = "participant_action fa fa-commenting-o fa-fw";
var class_role_guest = "participant_action fa fa-comment-o fa-fw";
var class_role_chair_selected = "participant_action fa fa-commenting fa-fw";
var class_role_guest_selected = "participant_action fa fa-comment fa-fw";
var class_conference_start_conference = "conference_action fa fa-play fa-fw green";
var class_buzz_on = "participant_action fa fa-hand-paper-o grey fa-fw";
var class_buzz_off = "participant_action fa fa-hand-paper-o grey fa-rotate-180 fa-fw";


function DumpObject(obj)
{
  var od = new Object;
  var result = "";
  var len = 0;

  for (var property in obj)
  {
    var value = obj[property];
    if (typeof value == 'string')
      value = "'" + value + "'";
    else if (typeof value == 'object')
    {
      if (value instanceof Array)
      {
        value = "[ " + value + " ]";
      }
      else
      {
        var ood = DumpObject(value);
        value = "{ " + ood.dump + " }";
      }
    }
    result += "'" + property + "' : " + value + ", ";
    len++;
  }
  od.dump = result.replace(/, $/, "");
  od.len = len;

  return od;
}

function show_info() {
    var modal = document.getElementById("myinfomodal");
    modal.style.display = "block";
}

function hide_info() {
    var modal = document.getElementById("myinfomodal");
    modal.style.display = "none";
}

function getURLParameter(name) {
  // Only find single (first) entry of name for now
  var value = null;
  var regex = new RegExp('[?|&]' + name + '(=([^&;]+?)(&|#|;|$))?').exec(location.search);
  if (regex) {
      value = regex[2] || name;
  }
  if (value) {
      return decodeURIComponent(value);
  } else {
      return null;
  }
}

function action_request_args() {
    var conference_url = getURLParameter('conference');
    if (conference_url) {
        document.getElementById("conference").value = conference_url;
    }
    var worker = getURLParameter('worker');
    if (worker) {
        document.getElementById("worker").value = worker;
    }
    var pin_url = getURLParameter('pin');
    if (pin_url) {
        document.getElementById("pin").value = pin_url;
    }
    var extension = getURLParameter('extension');
    if (extension) {
        document.getElementById("two_stage_dial_ext").value = extension;
    }
    var name_url = getURLParameter('name');
    if (name_url) {
        document.getElementById("display_name").value = name_url;
    }
    if (conference_url && worker) {
        var join_url = getURLParameter('join');
        if (join_url) {
            user.join();
            var dial = getURLParameter('dial');
            if (dial) {
                var dial_url = getURLParameter('dial_uri');
                var dial_protocol = getURLParameter('dial_protocol');
                user.action_dial(dial_protocol, conference_url, conference_url, dial_url, 'host');
            }
        }
    }
}

function update_hostoverlaytext() {
    // Overlay text updated
    // If positional, show positional text
    // else hide
    var overlay_text = document.getElementById("overlay_text");
    var positional_text_div = document.getElementById("hostpositionaltextdiv");
    if (overlay_text.value == "positional") {
        positional_text_div.className = "";
    } else {
        positional_text_div.className = "hide";
    }
}

function update_guestoverlaytext() {
    // Overlay text updated
    // If positional, show positional text
    // else hide
    var overlay_text = document.getElementById("guest_overlay_text");
    var positional_text_div = document.getElementById("guestpositionaltextdiv");
    if (overlay_text.value == "positional") {
        positional_text_div.className = "";
    } else {
        positional_text_div.className = "hide";
    }
}

function update_audience() {
    // Audience drop down updated
    // If hosts is selected, make sure
    // auto is removed from plus_n
    // and show guest view params
    // and add it back if everyone selected
    // and hide guest view params
    var auto_option = document.getElementById("auto_option");
    var plus_n_element = document.getElementById("plusn");
    var audience_element = document.getElementById("audience");
    var guestlayout_element = document.getElementById("guestlayout");
    if (audience_element.value == 'hosts') {
        auto_option.disabled = true;
        if (plus_n_element.value == 'auto') {
            plus_n_element.value = 'off';
        }
        guestlayout_element.className = "";
    } else {
        auto_option.disabled = false;
        guestlayout_element.className = "hide";
    }
}
function Participant(participant_data) {
    this.uuid = participant_data["uuid"];
    this.speaking = false;
    this.element_root = document.createElement("li");
    this.element_root.className = "roster_entry";

    this.uri = participant_data["uri"];

    if (participant_data["display_name"] != "") {
        this.uri = this.uri + " - " + participant_data["display_name"];
    }

    if (this.uuid == user.participant_uuid) {
        this.uri = this.uri + " <span class='pexorange'>[this client]</span>";
    }

    this.uri_element = document.createElement("div");
    this.uri_element.className = "participant_uri";
    this.uri_element.innerHTML = this.uri;

    console.log("has_media " + participant_data["has_media"]);
    this.enable_media_buttons = participant_data["has_media"] && (user.role == 'HOST');

    // Add layout check
    this.layout = document.createElement("input");
    this.layout.setAttribute('type', 'checkbox');
    this.element_root.appendChild(this.layout);

    // Add avatar
    this.avatar = document.createElement("img");
    this.avatar.src = "https://" + user.node + "/api/client/v2/conferences/" + user.conference + "/participants/" + this.uuid + "/avatar.jpg?width=80&height=80&token=" + user.token;
    this.avatar.onerror = this.avatar_error.bind(this);
    this.avatar.height = 40;
    this.avatar.addEventListener('click', this.avatar_click.bind(this), false);
    this.element_root.appendChild(this.avatar);

    // Add protocol
    if (participant_data["protocol"] != undefined) {
        this.protocol_element = document.createElement("div");
        this.protocol_element.className = "participant_uri";
        this.protocol_element.innerHTML = "<b>" + participant_data["protocol"] + "</b>";
        this.element_root.appendChild(this.protocol_element);
    }

    // Add role host/guest
    this.chair_role_element = document.createElement("div");
    if (participant_data["role"] === "chair") {
        this.chair_role_element.className = class_role_chair_selected;
    } else {
        this.chair_role_element.className = class_role_chair;
    }
    this.chair_role_element.addEventListener('click', this.chair_role.bind(this), false);
    this.element_root.appendChild(this.chair_role_element);
    this.guest_role_element = document.createElement("div");
    if (participant_data["role"] === "guest") {
        this.guest_role_element.className = class_role_guest_selected;
    } else {
        this.guest_role_element.className = class_role_guest;
    }
    this.guest_role_element.addEventListener('click', this.guest_role.bind(this), false);
    this.element_root.appendChild(this.guest_role_element);


    // Add buzz button/status
    this.buzz_element = document.createElement("div");
    this.buzz_state = participant_data["buzz_time"] != 0;
    if (this.buzz_state) {
        this.buzz_element.className = class_buzz_on;
    } else {
        this.buzz_element.className = class_buzz_off;
    }
    this.buzz_element.addEventListener('click', this.buzz.bind(this), false);
    this.element_root.appendChild(this.buzz_element);

    // Add spotlight button/status
    this.spotlight_element = document.createElement("div");
    this.spotlight_state = participant_data["spotlight"] != 0;
    if (this.spotlight_state) {
        this.spotlight_element.className = class_spotlight_on;
    } else {
        this.spotlight_element.className = class_spotlight_off;
    }
    this.spotlight_element.addEventListener('click', this.spotlight.bind(this), false);
    this.element_root.appendChild(this.spotlight_element);

    // Add mute button/status
    this.mute_element = document.createElement("div");
    this.mute_state = participant_data["is_muted"] == "YES";
    if (this.mute_state) {
        this.mute_element.className = class_mute_on;
    } else {
        this.mute_element.className = class_mute_off;
    }
    this.mute_element.addEventListener('click', this.mute.bind(this), false);
    this.element_root.appendChild(this.mute_element);

    // Add hold/resume button/status
    this.hold_element = document.createElement("div");
    if (participant_data["is_held"] == "YES") {
        this.hold_element.className = class_hold_on;
    } else {
        this.hold_element.className = class_hold_off;
    }
    this.hold_element.addEventListener('click', this.hold.bind(this), false);
    this.element_root.appendChild(this.hold_element);

    // Add see presentation button/status
    this.see_presentation_element = document.createElement("div");
    this.see_presentation_state = participant_data["rx_presentation_policy"] == "ALLOW";
    console.log("see_presentation_state " + this.see_presentation_state);
    if (this.see_presentation_state) {
        this.see_presentation_element.className = class_see_presentation_allowed;
    } else {
        this.see_presentation_element.className = class_see_presentation_denied;
    }
    this.see_presentation_element.addEventListener('click', this.see_presentation.bind(this), false);
    this.element_root.appendChild(this.see_presentation_element);

    // Add overlay text
    this.overlay_text_element = document.createElement("div");
    this.overlay_text_element.className = "particpantOverlayText";

    var currentOverlayText = document.createElement("input");
    currentOverlayText.setAttribute('size', '30');
    currentOverlayText.className = "currentoverlaytext";
    currentOverlayText.setAttribute('disabled', 'true');
    currentOverlayText.id = "currenttext_" + participant_data["uuid"];
    currentOverlayText.value = participant_data["overlay_text"];

    var newOverlayText = document.createElement("input");
    newOverlayText.setAttribute('size', '30');
    newOverlayText.id = "newtext_" + participant_data["uuid"];

    var updateTextButton = document.createElement("input");
    updateTextButton.setAttribute('type', 'button');
    updateTextButton.setAttribute('value', 'update');
    updateTextButton.addEventListener('click', this.overlay.bind(this), false);

    var resetTextButton = document.createElement("input");
    resetTextButton.setAttribute('type', 'button');
    resetTextButton.setAttribute('value', 'reset');
    resetTextButton.addEventListener('click', this.reset_overlay.bind(this), false);

    this.overlay_text_element.appendChild(currentOverlayText);
    this.overlay_text_element.appendChild(newOverlayText);
    this.overlay_text_element.appendChild(updateTextButton);
    this.overlay_text_element.appendChild(resetTextButton);

    // Add transfer button
    if (participant_data["protocol"] != "mssip") {
        this.transfer_element = document.createElement("div");
        this.transfer_element.className = "transferText";

        var transferText = document.createElement("input");
        transferText.setAttribute('size', '30');
        transferText.id = "transfer_" + participant_data["uuid"];
        var transferRole = document.createElement("select");
        transferRole.id = "transferrole_" + participant_data["uuid"];
        var norole = document.createElement("option");
        norole.setAttribute('value', 'norole');
        norole.innerHTML = "";
        transferRole.appendChild(norole);
        var host = document.createElement("option");
        host.setAttribute('value', 'host');
        host.innerHTML = "Host";
        transferRole.appendChild(host);
        var guest = document.createElement("option");
        guest.setAttribute('value', 'guest');
        guest.innerHTML = "Guest";
        transferRole.appendChild(guest);
        var transferPin = document.createElement("input");
        transferPin.setAttribute('size', '5');
        transferPin.id = "transferpin_" + participant_data["uuid"];
        var transferButton = document.createElement("input");
        transferButton.setAttribute('type', 'button');
        transferButton.setAttribute('value', 'transfer');
        transferButton.addEventListener('click', this.transfer.bind(this), false);

        this.transfer_element.appendChild(transferText);
        this.transfer_element.appendChild(transferRole);
        this.transfer_element.appendChild(transferPin);
        this.transfer_element.appendChild(transferButton);
    }

    // Add disconnect button
    var disconnect = document.createElement("div");
    disconnect.className = class_disconnect;
    disconnect.addEventListener('click', this.disconnect.bind(this), false);
    this.element_root.appendChild(disconnect);

    // Add unlock
    this.unlock_element = document.createElement("div");
    this.unlock_element.className = "hide";
    this.unlock_element.addEventListener('click', this.unlock.bind(this), false);
    this.element_root.appendChild(this.unlock_element);

    this.element_root.appendChild(this.uri_element);
    this.element_root.appendChild(this.overlay_text_element);
    if (this.transfer_element != undefined) {
        this.element_root.appendChild(this.transfer_element);
    }

    if (!this.enable_media_buttons) {
        this.spotlight_element.classList.add("disabled_action");
        this.mute_element.classList.add("disabled_action");
        this.hold_element.classList.add("disabled_action");
        this.unlock_element.classList.add("disabled_action");
        this.layout.classList.add("hide");
    }

    // Add into the correct list based on service_type
    this.service_type = participant_data["service_type"];
    if (this.service_type == "conference" || this.service_type == "lecture" || this.service_type == "gateway") {
        if (this.buzz_state) {
            console.log("Adding to buzzing");
            document.getElementById("buzzing").appendChild(this.element_root);
        } else {
            console.log("Adding to rosterlist");
            document.getElementById("rosterlist").appendChild(this.element_root);
        }
    } else {
        console.log("Adding to waitingroom");
        if (user.locked == true) {
            // Show participant unlock button
            this.unlock_element.className = user.role + " " + class_lock_on;
        }
        document.getElementById("waitingroom").appendChild(this.element_root);
    }
}

Participant.prototype.update = function (participant_data) {
    // console.log("participant update " + this);
    pp = DumpObject(participant_data);
    console.log("participant update: " + JSON.stringify(pp));
    if (participant_data["service_type"] != this.service_type) {
        // Might need to move lists
        if (participant_data["service_type"] == "conference" || participant_data["service_type"] == "lecture" || participant_data["service_type"] == "gateway") {
            try {
                document.getElementById("waitingroom").removeChild(this.element_root);
            } catch(error) {
                console.log("Unable to remove participant from waiting room was:" + this.service_type + " now:" + participant_data["service_type"]);
            }
            document.getElementById("rosterlist").appendChild(this.element_root);
            this.unlock_element.className = "hide";
        }
        this.service_type = participant_data["service_type"];
    }

    if (participant_data["protocol"] != undefined) {
        this.protocol_element.innerHTML = "<b>" + participant_data["protocol"] + "</b>";
    }

    this.enable_media_buttons = participant_data["has_media"] && (user.role == 'HOST');
    console.log("enable_media_buttons " + this.enable_media_buttons);

    this.overlay_text = participant_data["overlay_text"];
    document.getElementById("currenttext_" + this.uuid).value = this.overlay_text;

    // Update mute status
    this.mute_state = participant_data["is_muted"] == "YES";
    if (this.mute_state) {
        this.mute_element.className = class_mute_on;
    } else {
        this.mute_element.className = class_mute_off;
    }

    // Update role
    if (participant_data["role"] === "chair") {
        this.chair_role_element.className = class_role_chair_selected;
    } else {
        this.chair_role_element.className = class_role_chair;
    }
    if (participant_data["role"] === "guest") {
        this.guest_role_element.className = class_role_guest_selected;
    } else {
        this.guest_role_element.className = class_role_guest;
    }

    // Update buzz status
    var old_buzz = this.buzz_state;
    this.buzz_state = participant_data["buzz_time"] != 0;
    if (this.buzz_state && !old_buzz) {
        this.buzz_element.className = class_buzz_on;
        document.getElementById("rosterlist").removeChild(this.element_root);
        document.getElementById("buzzing").appendChild(this.element_root);
    } else if (old_buzz) {
        this.buzz_element.className = class_buzz_off;
        document.getElementById("buzzing").removeChild(this.element_root);
        document.getElementById("rosterlist").appendChild(this.element_root);
    }

    // Update spotlight status
    this.spotlight_state = participant_data["spotlight"] != 0;
    if (this.spotlight_state) {
        this.spotlight_element.className = class_spotlight_on;
    } else {
        this.spotlight_element.className = class_spotlight_off;
    }

    // Update see presentation status
    this.see_presentation_state = participant_data["rx_presentation_policy"] == "ALLOW";
    if (this.see_presentation_state) {
        this.see_presentation_element.className = class_see_presentation_allowed;
    } else {
        this.see_presentation_element.className = class_see_presentation_denied;
    }

    if (!this.enable_media_buttons) {
        this.spotlight_element.classList.add("disabled_action");
        this.mute_element.classList.add("disabled_action");
        this.hold_element.classList.add("disabled_action");
        this.layout.classList.add("hide");
    } else {
        this.spotlight_element.classList.remove("disabled_action");
        this.mute_element.classList.remove("disabled_action");
        this.hold_element.classList.remove("disabled_action");
        this.layout.classList.remove("hide");
    }

};

Participant.prototype.remove = function () {
    console.log("participant remove " + this);
    if (this.service_type == "conference" || this.service_type == "lecture" || this.service_type == "gateway") {
        console.log("Remove from roster");
        try {
            document.getElementById("rosterlist").removeChild(this.element_root);
        } catch(error) {
            console.log("Unable to remove from rosterlist");
        }
    } else {
        console.log("Remove from waitingroom");
        try {
            document.getElementById("waitingroom").removeChild(this.element_root);
        } catch(error) {
            console.log("Unable to remove from waitingroom");
        }
    }
};

Participant.prototype.disconnect = function () {
    console.log("participant disconnect " + this);
    if (user.role == "HOST") {
        user.post_request("participants/" + this.uuid + "/disconnect", null);
    }
};

Participant.prototype.mute = function () {
    console.log("participant mute " + this);
    if (this.enable_media_buttons) {
        if (this.mute_state) {
            user.post_request("participants/" + this.uuid + "/unmute", null);
            this.mute_state = false;
            this.mute_element.className = class_mute_off;
        } else {
            user.post_request("participants/" + this.uuid + "/mute", null);
            this.mute_state = true;
            this.mute_element.className = class_mute_on;
        }
    }
};

Participant.prototype.buzz = function () {
    console.log("participant buzz " + this);
    if (this.buzz_state) {
        user.post_request("participants/" + this.uuid + "/clearbuzz", null);
        this.buzz_element.className = class_buzz_off;
    } else {
        if (this.uuid == user.participant_uuid) {
            user.post_request("participants/" + this.uuid + "/buzz", null);
            this.buzz_element.className = class_buzz_on;
        }
    }
};

Participant.prototype.spotlight = function () {
    console.log("participant spotlight " + this);
    if (this.enable_media_buttons) {
        if (this.spotlight_state) {
            user.post_request("participants/" + this.uuid + "/spotlightoff", null);
            this.spotlight_element.className = class_spotlight_off;
        } else {
            user.post_request("participants/" + this.uuid + "/spotlighton", null);
            this.spotlight_element.className = class_spotlight_on;
        }
    }
};

Participant.prototype.chair_role = function () {
    console.log("participant chair role " + this);
    if (user.role == "HOST") {
        user.post_request("participants/" + this.uuid + "/role", {"role": "chair"});
        this.chair_role_element.className = class_role_chair_selected;
        this.guest_role_element.className = class_role_guest;
    }
};

Participant.prototype.guest_role = function () {
    console.log("participant chair role " + this);
    if (user.role == "HOST") {
        user.post_request("participants/" + this.uuid + "/role", {"role": "guest"});
        this.chair_role_element.className = class_role_chair;
        this.guest_role_element.className = class_role_guest_selected;
    }
};

Participant.prototype.hold = function () {
    console.log("participant hold " + this);
    if (this.enable_media_buttons) {
        if (this.hold_element.className == user.role + " " + class_hold_on) {
            user.post_request("participants/" + this.uuid + "/resume", null);
            this.hold_element.className = user.role + " " + class_hold_off;
        } else {
            user.post_request("participants/" + this.uuid + "/hold", null);
            this.hold_element.className = user.role + " " + class_hold_on;
        }
    }
};

Participant.prototype.start_speaking = function () {
    console.log("participant start_speaking " + this);
    if (!this.speaking) {
        this.speaking = true;
        this.uri_element.className = "participant_uri_speaking";
    }
};

Participant.prototype.stop_speaking = function () {
    console.log("participant stop_speaking " + this);
    if (this.speaking) {
        this.speaking = false;
        this.uri_element.className = "participant_uri";
    }
};

Participant.prototype.unlock = function () {
    console.log("participant unlock " + this);
    user.post_request("participants/" + this.uuid + "/unlock", null);
    this.unlock_element.className = "hide";
};

Participant.prototype.conference_lock = function (locked) {
    console.log("participant conference_lock " + this);
    if (this.service_type != "conference" && this.service_type != "lecture") {
        if (locked == true) {
            // Show participant unlock button
            this.unlock_element.className = class_lock_on;
        } else {
            this.unlock_element.className = "hide";
        }
    }
};

Participant.prototype.overlay = function () {
    console.log("participant overlay " + this);
    var overlay = document.getElementById("newtext_" + this.uuid).value;
    var text_data = {"text": overlay};
    var response = user.post_request("participants/" + this.uuid + "/overlaytext", text_data);
    if (response["status"] == 200) {
        document.getElementById("currenttext_" + this.uuid).value = overlay;
        document.getElementById("newtext_" + this.uuid).value = "";
    } else {
        document.getElementById("newtext_" + this.uuid).value = "FAILED";
    }
};

Participant.prototype.reset_overlay = function () {
    console.log("participant reset_overlay " + this);
    var response = user.post_request("participants/" + this.uuid + "/overlaytext");
    if (response["status"] == 200) {
        document.getElementById("currenttext_" + this.uuid).value = "";
        document.getElementById("newtext_" + this.uuid).value = "";
    } else {
        document.getElementById("newtext_" + this.uuid).value = "FAILED";
    }
};

Participant.prototype.transfer = function () {
    console.log("participant transfer" + this);
    var target = document.getElementById("transfer_" + this.uuid).value;
    var role = document.getElementById("transferrole_" + this.uuid).value;
    var pin = document.getElementById("transferpin_" + this.uuid).value;
    var text_data = {"conference_alias": target};
    if (role != "norole") {
        text_data["role"] = role;
        text_data["pin"] = pin;
    }
    var response = user.post_request("participants/" + this.uuid + "/transfer", text_data);
};

Participant.prototype.see_presentation = function () {
    console.log("participant see presentation " + this);
    if (user.role == 'HOST') {
        if (this.see_presentation_state) {
            user.post_request("participants/" + this.uuid + "/denyrxpresentation", null);
            this.see_presentation_state = false;
            this.see_presentation_element.className = class_see_presentation_denied;
        } else {
            user.post_request("participants/" + this.uuid + "/allowrxpresentation", null);
            this.see_presentation_state = true;
            this.see_presentation_element.className = class_see_presentation_allowed;
        }
    }
};

Participant.prototype.avatar_error = function () {
    var fallback = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAABwCAYAAADG4PRLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAADetJREFUeNrsXQmQFeUR7pl37i7IssAuyAIKKorKpZgYURBjMIpGUcsrVjRqIlFzlKmyzKEmRlMpyyRqeaBUlGCIRxQVxaiFCsELBJRDQVFgkQVhWVh2913zZibd/c+b4+0jRvJY35DuqinY2Xn/zN/f391f99/zVmu/YzwUydF4XIXHCXgcCiKVIBvweAuPR5x/XdGKAHwAjx+KvipaHsfju3jk6Qfd94tXBLxQyAV4LC1gVwBwOh7fFN2ERkbi8XzBhR6G/64VnYRSTiYL/InoIbRyPQE4SfQQWjmKABwqegit9CIADdFDaMUiAC3RQ2jF1kUH4RYBUAAUEQBFBEABUEQAFBEARQRAAVBEABQRAEUEQAFQRAAUEQBFBEABUEQAFBEARQRAAVBEABQRAEUEwP1DoqKCUqLh0tbBbt8Gdno3QCwJeq8D8TSety0BsPL9UgTsXZ+BPvBoiA45DqzWDWB8+AqCOECBKwBWtthtWyAycBRUX/E31FBCYTrvVsi++TDotQMlBlY4fGCndkB8wjQXPJL4xGtAi1UBmDkBsPLjXwyslk8DZ62dmwGMNP5aFwArHsLaAyG34D7Ir30N7GwHWFvXQObZXzKZIXAr6lnb7xiPNAt6Cmz+ZR1F9rkLLS4Deu9GsDp3AiCQBCyYFfU+bMs+JjE2TjivqLcWAYjsxe1sHMMqjKE7Y2hffF/6HC9RrfT1/PvCNUWOCO+nJQ/Ae8XBatuKsTAO2gEN/z149LyWqcbFxaCeISwslB8Wc6jdW8HOdSpFEBkw2sHOtINWXQtaj744QctTYJcxdFaw1YZxJ2+AVqWUCfkMjrGbx9R6NiglFY8Rian8De/FQ9XU4T17e8p3ALXbmsF2CIlO4CRq1GJz72+B1bHdvYeGIPI8+Oc9WG3nDj60BDq0eBXf0063eXmkf2FVJIA0cXxoIgCRg8ZB/NgLQR8wArR4NccSc9N7kHtnFliffwR6/SHKMoonRIpAkCgPix75bYiNOhv0fkNRgUk1RvMqMHAMc/NK0BuG+6zJ+S8unNiYc/H+x/HP+VXzIP/RAlw0fdQFBCQCFT/1epUSIFDGu3/H8Vbz4lIfyvBCSJ5xMy8AAi33xgx8JlxQiR4lk35rG86pbggkTroaIkOOwUVXC3Y+y3M1lj4J+Y8XgN7nILUIylgMKC+A6Dqs1o0QP/EHOPmblPvwG8fgY1i5mWduBGPFcwjMIUELIuvItvMqTp51G8THX9nlFpHBY3GMcyDz9A1gvDdHgWibLpB2ZwtED5sI0cNPUadam8BY9pQPwDwrNn7cxco70Kl1C1HBi1wA6fcaPnv8+O+59zWW/QPBWIPW1aNL0m9tXwfRQydA1Xl3gsbJvu95B46E2NjzIPvSHyA7/0+g9z2YF0e5LFEvp/VZOzZAHB82eeZvg+D53A4pqeri+yE67AS+Phh/NFwATZA87RddwCPLcq9CF1V10X1sZXR9YAx0tbQA3M+RKyX3518k9KxkTYVrDGVxAU/CCX2zd44st2hB0nX2zk0Q6X8EJv2zg+AVudrE5BsgjtZptW6q0DQi28mBPnHW77w5IEDpWVdC592TIfPUzxWzcyR59u2KkOS9xNhu3w6Rg7/GFuzqDd1u5/3fgQ4cIzXrigCQNIZGgHxVyTVavo25YfLMW7xTuRRk5tzIc049chlarfctZskpt6AbHaLiYqUBaJHrGjYe3VJP12JSD10AuaWP82rPvnoXgwnonvjG6D5jIyaD1f65N3m0nNjRU7wxt6yGzunngLn+HXZVxjuPQvqxa1zAIgOOBL1xdFkV8qXw62yFKC64yNBvOH42DemZl6OrvJPnbLz/DD7/ucpLOBI76nSwO1oq0AIRGL3hMC9mrH4RzC0fcNwj1kmWRWQi/8kb3s0pBlJ1g7VhKbbWd5g3xvvP4WR3gI4uSovXMDnIr1+CRGZ1wJ0SU/1KAESyRc/meYvlOMfX8DnH4Zz7QWTQGPRCGzFWP+3N+cAjy0piyluJ8ceiPOZSRKX9sQABKtD7AqHg/LDAJClW0WfcMQxFNCyP3pPLtDMdwZyrS56lFeV7JXJAu4g87fWcI75Yiosx3sPhZSp/5RQoXTRn9CaVR2JIaX6wKL75AaUHpgf3k4XilVhI2l2OHA+wPQKfCIdOeaTvfFAZzn18MSkAspPquMy1oIa9UmjR/iCRHF0vyk21YAGjzPuJ4aiFogLs3Z9jHtaMxOU2zC2PCILugkOExmTX5n50wHCwU7uclR9VMRcXhl7b6I1BIEci+7ZAHppKTLknTnnWtk8w1lVD9WUzIYokwGOt28BqXqHclC+NsDD2ul573EUQxxzPePcxxNrma5NTblbVGSYiLZBvWgp6dV0oy7aVDSCVszY3QWz0JKi69MEAwaEUJTXrKnSRaUxf+ruuSe/VH4yVz3POpfcdyjGq6pIHIDpyCuZsn2GCPwn0eo9sZeffxRu4GhcELAGwrIWd1o0I3slQc928wOYqVWAyz/2aS2tc2TB9cTNeDZDaCakZF0HNNXNB61mvLNGXnrjjvP1XyC64FxPxEaEEr7IBRHcXP+EKrqn6JfPCbyD72j2gIzB6nyLwXMM1Qad8VPvPcY1qtFok4e2WCIDlDH9aADyKd6nZ08DEXDJSj640mgwyVtcndnAxgUtbhfon8ZS3ZzIJih7xLc4nefJjz4PE9k/Qjf4Rc9jDQ2mFoWCh+bXzuTRlfvqWSoRpa4lSlhLUn/bvYiPPdF0npQypv1wCaQQ/88/bofOe08BYMtvzuBOmgV53EAMfRqlsANEicv+aDqmZl3Pyrvc/XBWid2/l+EjtfmyFgcJ5XllTIc4tng3G8qe5IhQZfCwX0zMv/t4teFOhINI4Cqz0TnGh5c6ZcgsfgPRj14I+aIyqsVIdFXO2xIlXc1GYAUYi4u7TkUVizkgph1v42LaO9+Y4R6TKSE0fbtalWmWkpo9bIQJzH7rPMm/idg+ApGyuzGiqMuFUQHjrxl9FKYp7/oTaalnPNUXeg3OqPFbHDoiNmarYJ91mxfOQ3/phcJ/OR2wYTH+1huJcNNa1OlKOtgcqsgdKe6pSY1tGsFoTBheq1fRWtUGtUCExeDKR3o1Fq9P0SlwIru2rG2p1g50xND4IfM1fXivUHyPxL1kFKe6TsUtf4weVnv8LQCbrpjmofhinPT+9C3RqhvIvlsLvKxnA6FFnQHT4KbwVZKEbMzcsgdjY891WB9ZJ80qvRcHZ1/Pvn8Uw+aa2B/Oz93kj1Ny0DOJfv9S1PiqZcd9MvLrMLo80owVaCKm/x2xeozxLpHRrYaRxNMTGXQhm01I1Z5x7dOjx3IXgznnT8q6epxJdKLk0ovLURmDtWM9EITHxOm8iG9+F/Jr5qk+k8JmeDbyHlpik/hoQ5Xk1056B7Mt3gEVtFqdeD/GJ13peesVcsLZ/Cnp9ef/MoYYu1u5o5UKB5hTOafM4OmIyMuJXOX52aa1wvEjV+X/mSo+FIGq1jZA45adu2Y6s01j1omrICgOJ0RI1kDz9VyV/l5lzg2pVp5jg5F/kdqmJNovJeuKMmxWIDcOh6tIZXY0EczpKC7jdrxBnyyXUlpFug9xbM7luyqeYxR6DpGgt2JtXlQbQkcSEH5U8n37ix1x75QJEmXLObk8jqEurc/pUMPFfrfeg4EQsmyeXXXA/ZObdusc+THPDYuiccSFvFWlchLYDRELzbTfxfqKvbUPtBVrcsOtewyw0eC+9bhAC+DDk3ny4RPzcw2LZQ8shufrMkz8D471nVc5ZsV1pPqH2QXKTsdHn8K65nd2NifjbkKNdgc6daje+y4Rtji9UhM69fi/GkMWKcaIVatGE2jn4eCG36RH5UaU0I8BitR71kF/9EsbGLW7M0Q6o91lXlDeFc4tmuMk+tTxw+2BAMwnQkQFn5t7ELYHRQ07CoJzgVhHXJRYTb7zOWPoEznmqSleQYFnUBrnsSTC3fKg6FsrsLPYZgHaqDbLz7gZj5QvcosdUmtr10P/r/YaVLoMVWBoqmUCjdj0qWvPOvhbhdj8CnXYcmLiUsFCOoxgb7cWPqp8pDSE3W7BCIiDoIqmeyoSE9n+RJbLV+sejxYX3oBidX7cI8h+8zAuE9hHJ1ZeqwdKzZxc+iHFuHlp1tWp6ot2S6loFHjUzV3Rjb1H80+sbuOjMnc3O3l6hWvLFia/NSuV6ptPFrVGqUdjl31OHNLvQPnjUeS6v2IXiWOo9P9u7ppS7dreoBvjoqVYaPGdxUBMydww4HeCaO2czpJWY/5kya3s5hlama/bien4nont2N+T1spCLACgAiuwfACJR0Kp6eWGAqLbThb3fChEmei2tMGfqzTHz3foIZSMx9GKHiXQ7R4yPiFoT5l8V9o0OZWfamLLQ6265RQ8xwaGSIacY3fgefflesY7G1YuV7S1OWaxOva2zP1shldxSreqFG9oxS/ZQ1SW2Qrs7nqCMr1izC61Vm6fuuf8HF4qg8XuOhXPd+56GkBghMSICoIgAKACKCIAiAqCIACgAigiAIgKgiAAoAIoIgCICoIgAKACKCIAiAqCIACgAigiAIgKgiAAoAIpUCICaqCG0wm9hxEQP4TVAArBJ9BBa6SAAF4keQitrCcB7RA+hlbsJwOV4zBFdhE6W4DG3kEZMxWOF6CQ0Ql9DdWpxHkjfA/ms6Kbi5XU8RuHBf7LN/4YuvU57toPs952L+kHZv91L5Mvkec6/rXjQn2yj7w97yn/BvwUYAJi0jOvOSO6yAAAAAElFTkSuQmCC";
    this.avatar.src = fallback;
    this.avatar.height = 40;
};

Participant.prototype.selected_for_layout = function() {
    return this.layout.checked;
};

Participant.prototype.avatar_click = function () {
    if (user.role == "HOST") {
        var layout = user.get_request("participants/" + this.uuid + "/layout");
        console.log("Participant (" + this.uuid + ") layout = " + layout);
    }
};

var user = {
    token : null,
    participant_uuid: null,
    node: null,
    conference: null,
    pin: null,
    event_source: null,
    conference_participants: {},
    token_refresh: null,
    role: null,
    locked: false,
    live_active: false,
    guests_muted: false,
    live_active_call: null,
    last_message_origin: null,
    rtsp_call: null,

    join : function() {
        this.join_with_token(null);
        return false;
    },

    join_with_token : function(token) {
        // Parse conference input into node and conference name
        this.conference = document.getElementById("conference").value;
        this.node = document.getElementById("worker").value;;
        this.pin = document.getElementById("pin").value;
        if (token) {
            this.token = token;
        }
        if (this.request_token()) {
            if (this.start_events()) {
                // Joined
                // Toggle join/leave button and show roster lists and conference actions
                var joinleave = document.getElementById("joinleave");
                joinleave.value = "Leave Conference";
                joinleave.className = "red";
                var joinleaveform = document.getElementById("joinleaveform");
                joinleaveform.onsubmit = user.leave.bind(this);
                var conference_status = this.get_request("conference_status");
                if (conference_status["status"] == 200) {
                    if (conference_status["data"]["result"]["locked"]) {
                        this.locked = true;
                        document.getElementById("conflock").className = class_conference_lock_on;
                    } else {
                        this.locked = false;
                        document.getElementById("conflock").className = class_conference_lock_off;
                    }
                    if (conference_status["data"]["result"]["guests_muted"]) {
                        this.guests_muted = true;
                        document.getElementById("guestsmuted").className = class_conference_guests_mute_on;
                    } else {
                        this.guests_muted = false;
                        document.getElementById("guestsmuted").className = class_conference_guests_mute_off;
                    }
                }
                document.getElementById("disconnectall").className = class_conference_disconnect_all;
                document.getElementById("start_conf").className = class_conference_start_conference;

                if (this.role == 'GUEST') {
                    document.getElementById("start_conf").classList.add("disabled_action");
                    document.getElementById("conflock").classList.add("disabled_action");
                    document.getElementById("guestsmuted").classList.add("disabled_action");
                    document.getElementById("disconnectall").classList.add("disabled_action");
                } else {
                    document.getElementById("start_conf").classList.remove("disabled_action");
                    document.getElementById("conflock").classList.remove("disabled_action");
                    document.getElementById("guestsmuted").classList.remove("disabled_action");
                    document.getElementById("disconnectall").classList.remove("disabled_action");
                }

                document.getElementById("confcontrol").className = "";
                if (typeof jwplayer !== 'undefined') {
                    document.getElementById("liveviewdiv").className = "";
                }
                var canvas = document.getElementById("layout_canvas");
                var ctx = canvas.getContext("2d");
                ctx.clearRect(0, 0, 280, 200);

                console.log("Joined " + this);
            } else {
                this.release_token();
            }
        }
    },

    leave : function() {
        if (this.live_active) {
            try {
                jwplayer("liveviewplayer").remove();
                jwplayer("liveviewpresplayer").remove();
            }
            catch(err) {
                console.log("Failed to remove jwplayer");
            }
            this.live_active = false;
        }

        if (this.event_source) {
            this.event_source.close();
            this.event_source = null;
        }
        console.log("leave " + this);

        if (this.token_refresh) {
            clearInterval(this.token_refresh);
            this.token_refresh = null;
        }

        for (var participant in this.conference_participants) {
            if (this.conference_participants.hasOwnProperty(participant)) {
                this.conference_participants[participant].remove();
            }
        }

        this.conference_participants = {};

        this.reset_players();

        this.release_token();

        document.getElementById("presentation").className= "hide";
        document.getElementById("liveviewdiv").className = "hide";
        document.getElementById("rtmpaddress").value = "";
        document.getElementById("confcontrol").className = "hide";

        var chatbox_element = document.getElementById("chatbox");
        chatbox_element.innerHTML = "";

        var joinleave = document.getElementById("joinleave");
        joinleave.value = "Join Conference";
        joinleave.className = "green";
        var joinleaveform = document.getElementById("joinleaveform");
        joinleaveform.onsubmit = user.join.bind(this);
        return false;
    },

    request_token : function() {
        var display_name = document.getElementById("display_name").value;
        var two_stage_dial_ext = document.getElementById("two_stage_dial_ext").value;
        var start_if_host = document.getElementById("start_if_host").checked;
        var data = { "display_name" : display_name,
                     "start_conference_if_host": start_if_host };
        if (two_stage_dial_ext) {
            data["conference_extension"] = two_stage_dial_ext;
        }
        var join_error = document.getElementById("joinerror");
        join_error.innerHTML = "";
        var response = this.post_request("request_token", data);
        console.log("response " + response["status"]);
        if (response["status"] == 200) {
            this.token = response["data"]["result"]["token"];
            this.participant_uuid = response["data"]["result"]["participant_uuid"];
            this.role = response["data"]["result"]["role"];
            if (this.role == undefined) {
                this.role = "HOST";
            }
            var expires = response["data"]["result"]["expires"];
            if (expires === undefined) {
                expires = 120;
            }
            this.token_refresh = setInterval(this.refresh_token.bind(this), (expires * 1000) / 2);
            var chat_enabled = response["data"]["result"]["chat_enabled"];
            if (chat_enabled == true) {
                document.getElementById("chatdiv").className = "";
            } else {
                document.getElementById("chatdiv").className = "hide";
            }
            return true;
        } else if (response["status"] == 403) {
            html_text = "Failed to join conference: " + response["status"] + "(" + JSON.stringify(response["data"]) + ")";
            if (response["data"]["result"]["pin"] == "required") {
                html_text = "Failed to join conference: Pin required";
                if (response["data"]["result"]["guest_pin"] == "none") {
                    html_text += " (none for Guest)";
                }
            } else if (response["data"]["result"]["conference_extension"] == "required") {
                if (response["data"]["result"]["conference_extension_type"] == "mssip") {
                    html_text = "Failed to join conference: Lync conference extension required";
                } else {
                    html_text = "Failed to join conference: Extension required";
                }
            }
            join_error.innerHTML = html_text;
        } else if (response["status"] == 0) {
            join_error.innerHTML = "Failed to join conference: " + JSON.stringify(response["data"]);
        } else {
            join_error.innerHTML = "Failed to join conference: " + response["status"] + "(" + JSON.stringify(response["data"]) + ")";
        }
        return false;
    },

    refresh_token: function() {
        console.log("refresh_token this " + this);
        var response = this.post_request("refresh_token", null);
        console.log("response " + response["status"]);
        if (response["status"] == 200) {
            this.token = response["data"]["result"]["token"];
            role = response["data"]["result"]["role"] || this.role;
            if (this.role != role) {
                this.role = role;
                if (this.role == 'GUEST') {
                    document.getElementById("start_conf").classList.add("disabled_action");
                    document.getElementById("conflock").classList.add("disabled_action");
                    document.getElementById("guestsmuted").classList.add("disabled_action");
                    document.getElementById("disconnectall").classList.add("disabled_action");
                } else {
                    document.getElementById("start_conf").classList.remove("disabled_action");
                    document.getElementById("conflock").classList.remove("disabled_action");
                    document.getElementById("guestsmuted").classList.remove("disabled_action");
                    document.getElementById("disconnectall").classList.remove("disabled_action");
                }
            }
        } else {
            console.log("Refresh failed, leave conference");
            this.leave();
            alert("Token refresh failed");
        }
        return false;
    },

    release_token : function() {
        if (this.token) {
            this.post_request("release_token", null);
            this.token = null;
        }
    },

    liveview : function() {
        if (this.token) {
            console.log("live_active " + this.live_active);
            if (this.live_active == false) {
                dual_live = document.getElementById("dual_live_sel").checked;
                var call_data = {"call_type": "rtmp", "streaming": "true"};
                if (!dual_live) {
                    call_data['present'] = "main";
                } else {
                    call_data['present'] = "receive";
                }
                var response = user.post_request("participants/" + this.participant_uuid + "/calls", call_data);
                if (response["status"] == 200) {
                    var url = response["data"]["result"]["url"] + "-stream";
                    this.live_active_call = response["data"]["result"]["call_uuid"];
                    console.log("url: " + url);
                    if (dual_live) {
                        var pres_url = response["data"]["result"]["url"] + "-presentation";
                        console.log("pres_url: " + pres_url);
                        jwplayer("liveviewpresplayer").setup({file: pres_url,
                                                              height: 240,
                                                              width: 400,
                                                              aspectratio: "16:9",
                                                              controls: false,
                                                              stretching: "exactfit",
                                                              stagevideo: true,
                                                              rtmp: {bufferlength: 0.1}});
                        jwplayer("liveviewpresplayer").play(true);
                    }
                    jwplayer("liveviewplayer").setup({file: url,
                                                      height: 240,
                                                      width: 400,
                                                      aspectratio: "16:9",
                                                      controls: false,
                                                      stretching: "exactfit",
                                                      stagevideo: true,
                                                      rtmp: {bufferlength: 0.1}});
                    jwplayer("liveviewplayer").play(true);
                    this.live_active = true;
                    document.getElementById("dual_live").className = "hide";
                    document.getElementById("liveview").value = "Stop live view";
                }
            } else {
                this.reset_players();
            }
        }
    },

    reset_players : function() {
        this.live_active = false;

        var player_wrapper = document.getElementById("liveviewplayer_wrapper");
        if (player_wrapper != null) {
            player_wrapper.innerHTML = "";
            player_wrapper.removeAttribute("style");
            player_wrapper.id = "liveviewplayer";
        }
        var presplayer_wrapper = document.getElementById("liveviewpresplayer_wrapper");
        if (presplayer_wrapper != null) {
            presplayer_wrapper.innerHTML = "";
            presplayer_wrapper.removeAttribute("style");
            presplayer_wrapper.id = "liveviewpresplayer";
        }

        document.getElementById("liveview").value = "Start live view";
        document.getElementById("dual_live").className = "";

        if (this.live_active_call != null) {
            var response = user.post_request("participants/" + this.participant_uuid + "/calls/" + this.live_active_call + "/disconnect", null);
            this.live_active_call = null;
        }

    },

    rtspjoin : function() {
        if (this.token) {
            var rtspaddress = document.getElementById("rtspaddress").value;
            if (rtspaddress) {
                var call_data = {"call_type": "rtsp", "url": rtspaddress};
                var response = user.post_request("participants/" + this.participant_uuid + "/calls", call_data);
                if (response["status"] == 200) {
                    console.log("RTSP success");
                    this.rtsp_call = response["data"]["result"]["call_uuid"];
                    document.getElementById("rtspjoin").disabled = true;
                    document.getElementById("rtspleave").disabled = false;
                }
            }
        }
    },

    rtspleave : function() {
        if (this.token) {
            if (this.rtsp_call != null) {
                var response = user.post_request("participants/" + this.participant_uuid + "/calls/" + this.rtsp_call + "/disconnect", null);
                this.rtsp_call = null;
                document.getElementById("rtspjoin").disabled = false;
                document.getElementById("rtspleave").disabled = true;
            }
        }
    },

    getrtmpaddress : function() {
        if (this.token) {
            document.getElementById("rtmpaddress").value="";
            var call_data = {"call_type": "rtmp", "streaming": "true"};
            var response = user.post_request("participants/" + this.participant_uuid + "/calls", call_data);
            if (response["status"] == 200) {
                var url = response["data"]["result"]["url"] + "-stream";
                console.log("url: " + url);
                document.getElementById("rtmpaddress").value=url;
            }
        }
    },

    start_conference : function() {
        start_conf_elem = document.getElementById("start_conf");
        if (this.role == "HOST" && !start_conf_elem.classList.contains("disabled_action") ) {
            this.post_request("start_conference", null);
            start_conf_elem.classList.add("disabled_action");
        }
    },

    lock : function() {
        if (this.role == "HOST") {
            if (this.locked == true) {
                this.post_request("unlock", null);
                this.locked = false;
                document.getElementById("conflock").className = class_conference_lock_off;
            } else {
                this.post_request("lock", null);
                this.locked = true;
                document.getElementById("conflock").className = class_conference_lock_on;
            }
        }
    },

    muteallguests : function() {
        if (this.role == "HOST") {
            if (this.guests_muted == true) {
                this.post_request("unmuteguests", null);
                this.guests_muted = false;
                document.getElementById("guestsmuted").className = class_conference_guests_mute_off;
            } else {
                this.post_request("muteguests", null);
                this.guests_muted = true;
                document.getElementById("guestsmuted").className = class_conference_guests_mute_on;
            }
        }
    },

    send_message : function() {
        var chatinput_element = document.getElementById("chatinput");
        var call_data = {"type": "text/plain",
                        "payload": chatinput_element.value};
        this.post_request("message", call_data);
        this.display_message("Me", chatinput_element.value);
        chatinput_element.value = "";
        return false;
    },

    receive_message : function(event) {
        message_data = JSON.parse(event.data);
        console.log("message " + message_data["origin"] + " " + message_data["payload"]);
        this.display_message(message_data["origin"], message_data["payload"]);
    },

    display_message : function(origin, message) {
        var chatbox_element = document.getElementById("chatbox");
        if (this.last_message_origin != origin) {
            this.last_message_origin = origin;
            var origin_element = document.createElement("span");
            origin_element.className ="message_origin";
            origin_element.innerHTML = origin + "<br/>";
            chatbox_element.appendChild(origin_element);
        }
        var message_element = document.createElement("span");
        message_element.className = "message";
        message_element.innerHTML = message + "<br/>";
        chatbox_element.appendChild(message_element);
        chatbox_element.scrollTop = chatbox_element.scrollHeight;
    },

    disconnect_all : function() {
        if (this.role == "HOST") {
            this.post_request("disconnect", null);
        }
    },

    start_events : function() {
        this.event_source = new EventSource("https://" + this.node + "/api/client/v2/conferences/" + this.conference + "/events?token=" + this.token);
        this.event_source.addEventListener("disconnect", user.disconnect.bind(this), false);
        this.event_source.addEventListener("conference_update", user.conference_update.bind(this), false);
        this.event_source.addEventListener("participant_create", user.participant_create.bind(this), false);
        this.event_source.addEventListener("participant_delete", user.participant_delete.bind(this), false);
        this.event_source.addEventListener("participant_update", user.participant_update.bind(this), false);
        this.event_source.addEventListener("presentation_start", user.presentation_start.bind(this), false);
        this.event_source.addEventListener("presentation_stop", user.presentation_stop.bind(this), false);
        this.event_source.addEventListener("presentation_frame", user.presentation_frame.bind(this), false);
        this.event_source.addEventListener("stage", user.stage.bind(this), false);
        this.event_source.addEventListener("refer", user.refer.bind(this), false);
        this.event_source.addEventListener("message_received", user.receive_message.bind(this), false);
        this.event_source.addEventListener("refresh_token", user.refresh_token.bind(this), false);
        this.event_source.addEventListener("layout", user.layout.bind(this), false);
        return true;
    },

    disconnect : function(event) {
        disconnect_data = JSON.parse(event.data);
        console.log("disconnect");
        this.leave();
        alert("You have been disconnected: " + disconnect_data["reason"]);
    },

    refer : function(event) {
        refer_data = JSON.parse(event.data);
        console.log("refer");
        this.leave();
        document.getElementById("conference").value = refer_data["alias"];
        this.join_with_token(refer_data["token"]);
    },

    conference_update : function(event) {
        conference_data = JSON.parse(event.data);
        console.log("conference_update");
        if (conference_data["locked"]) {
            this.locked = true;
            document.getElementById("conflock").className = class_conference_lock_on;
        } else {
            this.locked = false;
            document.getElementById("conflock").className = class_conference_lock_off;
        }
        if (conference_data["guests_muted"]) {
            this.guests_muted = true;
            document.getElementById("guestsmuted").className = class_conference_guests_mute_on;
        } else {
            this.guests_muted = false;
            document.getElementById("guestsmuted").className = class_conference_guests_mute_off;
        }
        if (this.role == 'GUEST') {
            document.getElementById("conflock").classList.add("disabled_action");
            document.getElementById("guestsmuted").classList.add("disabled_action");
        }
        // Go through all participants in the waitingroom and show/hide unlock icon
        for (var participant in this.conference_participants) {
            if (this.conference_participants.hasOwnProperty(participant)) {
                this.conference_participants[participant].conference_lock(this.locked);
            }
        }
    },

    participant_create : function(event) {
        participant_data = JSON.parse(event.data);
        console.log("participant_create " + participant_data["service_type"]);
        var new_participant = new Participant(participant_data);
        this.conference_participants[participant_data["uuid"]] = new_participant;
    },

    participant_delete : function(event) {
        participant_data = JSON.parse(event.data);
        console.log("participant_delete");
        this.conference_participants[participant_data["uuid"]].remove();
        delete this.conference_participants[participant_data["uuid"]];
    },

    participant_update : function(event) {
        participant_data = JSON.parse(event.data);
        console.log("participant_update " + participant_data["service_type"]);
        this.conference_participants[participant_data["uuid"]].update(participant_data);
    },

    presentation_start : function(event) {
        console.log("presentation_start");
        document.getElementById("presentation").className = "presentation_on";
    },

    presentation_stop : function(event) {
        console.log("presentation_stop");
        document.getElementById("presentation").className = "hide";
    },

    presentation_frame : function(event) {
        console.log("presentation_frame");
        var presentation = document.getElementById("presentation");
        presentation.src = "https://" + this.node + "/api/client/v2/conferences/" + this.conference + "/presentation.jpeg?id=" + event.lastEventId + "&token=" + this.token;
    },

    stage : function(event) {
        console.log("stage");
        stage_data = JSON.parse(event.data);
        var is_speaking = [];
        for (var i = 0; i < stage_data.length; i++) {
            if (stage_data[i]['vad'] > 0) {
                is_speaking[is_speaking.length] = stage_data[i]['participant_uuid'];
            }
        }
        for (var participant in this.conference_participants) {
            if (this.conference_participants.hasOwnProperty(participant)) {
                if (is_speaking.indexOf(participant) > -1) {
                    this.conference_participants[participant].start_speaking();
                } else {
                    this.conference_participants[participant].stop_speaking();
                }
            }
        }
    },

    layout : function(event) {
        console.log("layout event");
        layout_data = JSON.parse(event.data);
        var canvas = document.getElementById("layout_canvas");
        var ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, 280, 200);
        var positions = {
                          '1:0' : [
                                   { 'x': 40, 'y': 0, 'w': 200, 'h': 200 },
                                  ],
                          '4:0' : [
                                   { 'x': 40, 'y': 0, 'w': 100, 'h': 100 },
                                   { 'x': 140, 'y': 0, 'w': 100, 'h': 100 },
                                   { 'x': 40, 'y': 100, 'w': 100, 'h': 100 },
                                   { 'x': 140, 'y': 100, 'w': 100, 'h': 100 },
                                  ],
                          '1:7' : [
                                   { 'x': 80, 'y': 0, 'w': 120, 'h': 120 },
                                   { 'x': 0, 'y': 160, 'w': 40, 'h': 40 },
                                   { 'x': 40, 'y': 160, 'w': 40, 'h': 40 },
                                   { 'x': 80, 'y': 160, 'w': 40, 'h': 40 },
                                   { 'x': 120, 'y': 160, 'w': 40, 'h': 40 },
                                   { 'x': 160, 'y': 160, 'w': 40, 'h': 40 },
                                   { 'x': 200, 'y': 160, 'w': 40, 'h': 40 },
                                   { 'x': 240, 'y': 160, 'w': 40, 'h': 40 },
                                  ],
                          '1:21' : [
                                    { 'x': 100, 'y': 0, 'w': 80, 'h': 80 },
                                    { 'x': 0, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 40, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 80, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 120, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 160, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 200, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 240, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 0, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 40, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 80, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 120, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 160, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 200, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 240, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 0, 'y': 160, 'w': 40, 'h': 40 },
                                    { 'x': 40, 'y': 160, 'w': 40, 'h': 40 },
                                    { 'x': 80, 'y': 160, 'w': 40, 'h': 40 },
                                    { 'x': 120, 'y': 160, 'w': 40, 'h': 40 },
                                    { 'x': 160, 'y': 160, 'w': 40, 'h': 40 },
                                    { 'x': 200, 'y': 160, 'w': 40, 'h': 40 },
                                    { 'x': 240, 'y': 160, 'w': 40, 'h': 40 },
                                   ],
                          '2:21' : [
                                    { 'x': 50, 'y': 0, 'w': 80, 'h': 80 },
                                    { 'x': 150, 'y': 0, 'w': 80, 'h': 80 },
                                    { 'x': 0, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 40, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 80, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 120, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 160, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 200, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 240, 'y': 80, 'w': 40, 'h': 40 },
                                    { 'x': 0, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 40, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 80, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 120, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 160, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 200, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 240, 'y': 120, 'w': 40, 'h': 40 },
                                    { 'x': 0, 'y': 160, 'w': 40, 'h': 40 },
                                    { 'x': 40, 'y': 160, 'w': 40, 'h': 40 },
                                    { 'x': 80, 'y': 160, 'w': 40, 'h': 40 },
                                    { 'x': 120, 'y': 160, 'w': 40, 'h': 40 },
                                    { 'x': 160, 'y': 160, 'w': 40, 'h': 40 },
                                    { 'x': 200, 'y': 160, 'w': 40, 'h': 40 },
                                    { 'x': 240, 'y': 160, 'w': 40, 'h': 40 },
                                   ]
                        };
        var current = 0;
        for (var i = 0; i < layout_data['participants'].length; i++) {
            var participant_uuid = layout_data['participants'][i];
            var avatar = this.conference_participants[participant_uuid].avatar;
            position = positions[layout_data['view']][current++];
            ctx.drawImage(avatar, position['x'], position['y'], position['w'], position['h']);
        }
    },

    overridelayout : function(event) {
        var layouts = [];
        var participant_ids = [];
        for (var participant in this.conference_participants) {
            if (this.conference_participants.hasOwnProperty(participant)) {
                if (this.conference_participants[participant].selected_for_layout()) {
                    participant_ids[participant_ids.length] = this.conference_participants[participant].uuid;
                }
            }
        }
        console.log("participants: " + participant_ids);
        var actors_element = document.getElementById("actors");
        var layout_element = document.getElementById("layout");
        var plusn_element = document.getElementById("plusn");
        var removeself_element = document.getElementById("removeself");
        var vadbackfill_element = document.getElementById("vadbackfill");
        var overlaytext_element = document.getElementById("overlay_text");
        var indicators_element = document.getElementById("indicators");
        var audience_element = document.getElementById("audience");
        var host_positional_text_element = document.getElementById("hostpositionaltext");
        var actors_value = participant_ids;
        if (actors_element.value == "everyone") {
            actors_value = [];
        }

        var audience_value = [];
        if (audience_element.value == "hosts") {
            audience_value = "hosts";
        }

        positional_overlay_text = [];
        if (overlaytext_element.value == "positional") {
            positional_overlay_text = host_positional_text_element.value.split(",");
        }

        var plusn;
        if (plusn_element.value === "auto" || plusn_element.value === "off") {
            plusn = plusn_element.value;
        } else {
            plusn = parseInt(plusn_element.value, 10);
            if (Number.isNaN(plusn)) {
                throw new Error("plus n is not an int");
            }
        }

        layouts.push({"actors": actors_value,
                      "layout": layout_element.value,
                      "plus_n": plusn,
                      "vad_backfill": vadbackfill_element.checked,
                      "actors_overlay_text": overlaytext_element.value,
                      "indicators": indicators_element.value,
                      "audience": audience_value,
                      "remove_self": removeself_element.checked,
                      "positional_overlay_text": positional_overlay_text });

        if (audience_value == "hosts") {
            // Get the "guests" view
            var guest_actors_element = document.getElementById("guest_actors");
            var guest_layout_element = document.getElementById("guest_layout");
            var guest_plusn_element = document.getElementById("guest_plusn");
            var guest_removeself_element = document.getElementById("guest_removeself");
            var guest_vadbackfill_element = document.getElementById("guest_vadbackfill");
            var guest_overlaytext_element = document.getElementById("guest_overlay_text");
            var guest_indicators_element = document.getElementById("guest_indicators");
            var guest_audience_element = document.getElementById("guest_audience");
            var guest_positional_text_element = document.getElementById("guestpositionaltext");
            var guest_actors_value = participant_ids;
            if (guest_actors_element.value == "everyone") {
                guest_actors_value = [];
            }
            positional_overlay_text = [];
            if (guest_overlaytext_element.value == "positional") {
                positional_overlay_text = guest_positional_text_element.value.split(",");
            }

            layouts.push({"actors": guest_actors_value,
                          "layout": guest_layout_element.value,
                          "plus_n": guest_plusn_element.value,
                          "vad_backfill": guest_vadbackfill_element.checked,
                          "actors_overlay_text": guest_overlaytext_element.value,
                          "indicators": guest_indicators_element.value,
                          "audience": [],
                          "remove_self": guest_removeself_element.checked,
                          "positional_overlay_text": positional_overlay_text });
        }

        var call_data = {"layouts": layouts };
        var response = user.post_request("override_layout", call_data);
        if (response["status"] == 200) {
            console.log("Set new layout!");
        }
    },

    dial : function(event) {
        var protocol = document.getElementById("protocol");
        var localalias = document.getElementById("localalias");
        var localdisplayname = document.getElementById("localdisplayname");
        var remotealias = document.getElementById("remotealias");
        var role = document.getElementById("role");

        this.action_dial(protocol.value, localalias.value, localdisplayname.value, remotealias.value, role.value);
    },

    action_dial : function(protocol, source, source_display_name, destination, role) {
        var call_data = {"protocol": protocol,
                         "source" : source,
                         "destination" : destination,
                         "role" : role };
        if (protocol == "rtmp") {
            call_data["streaming"] = "yes";
        }
        if (source_display_name) {
            call_data["source_display_name"] = source_display_name;
        }
        var response = user.post_request("dial", call_data);
        if (response["status"] == 200) {
            console.log("Dial out success");
        }
    },

    resetlayout : function(event) {
        var call_data = {"layouts": [] };
        var response = user.post_request("override_layout", call_data);
        if (response["status"] == 200) {
            console.log("Reset layout!");
        }
    },

    transformlayout: function (event) {

        var transforms = {};

        var layout = document.getElementById("tl_layout").value;
        if (layout && layout !== "") {
            transforms["layout"] = layout;
        }
        var guest_layout = document.getElementById("tl_guest_layout").value;
        if (guest_layout && guest_layout !== "") {
            transforms["guest_layout"] = guest_layout;
        }

        var bools = ["recording", "streaming", "enable_overlay_text"];
        for (var i = 0; i<bools.length; i++) {
            var k = bools[i];
            var val = document.getElementById("tl_"+k).value;
            if (val === "on") {
                transforms[k] = true;
            } else if (val === "off") {
                transforms[k] = false;
            }
        }

        console.log("Transform layout: ", transforms);

        var response = user.post_request("transform_layout", {"transforms": transforms});
        if (response["status"] !== 200) {
            console.log("Transform layout failed:", response);
        } else {
            console.log("Layout transformed! .*_*. MAGIC .*_*.")
        }
    },

    resettransformlayout: function (event) {
        var response = user.post_request("transform_layout", {"transforms": {}});
        if (response["status"] !== 200) {
            console.log("Transform layout (reset/empty) failed:", response);
        } else {
            console.log("Layout reset! .*_*. MAGIC .*_*.")
        }
    },

    post_request : function(command, data) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open("POST", "https://" + this.node + "/api/client/v2/conferences/" + this.conference + "/" + command, false);
        if (this.token) {
            xmlhttp.setRequestHeader("token", this.token);
        }
        if (this.pin) {
            xmlhttp.setRequestHeader("pin", this.pin);
        }
        if (reg.token) {
            xmlhttp.setRequestHeader("registration_token", reg.token);
        }
        try {
            if (data) {
                xmlhttp.setRequestHeader("Content-Type", "application/json");
                xmlhttp.send(JSON.stringify(data));
            } else {
                xmlhttp.send();
            }
            console.log("responseText " + xmlhttp.responseText);
            return {"status" : xmlhttp.status, "data" : JSON.parse(xmlhttp.responseText)};
        } catch(exception) {
            console.log("Exception during post_request");
            return {"status" : xmlhttp.status, "data" : {"reason": exception.toString()}};
        }
    },

    get_request : function(command) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open("GET", "https://" + this.node + "/api/client/v2/conferences/" + this.conference + "/" + command, false);
        if (this.token) {
            xmlhttp.setRequestHeader("token", this.token);
        }
        if (this.pin) {
            xmlhttp.setRequestHeader("pin", this.pin);
        }
        try {
            xmlhttp.send();
            console.log("responseText " + xmlhttp.responseText);
            return {"status" : xmlhttp.status, "data" : JSON.parse(xmlhttp.responseText)};
        } catch(exception) {
            console.log("Exception during get_request");
            return {"status" : xmlhttp.status, "data" : {"reason": exception.toString()}};
        }
    },

};

var reg = {
    token : null,
    event_source: null,
    token_refresh: null,

    register : function() {
        var alias = document.getElementById("reg_alias").value;
        var host = document.getElementById("reg_host").value;
        this.node = host;
        this.alias = alias;
        if (this.request_token()) {
            if (this.start_events()) {
                // Registered
                // Toggle register/unregister button
                var regunreg = document.getElementById("register");
                regunreg.value = "Unregister";
                regunreg.className = "red";
                regunreg.onclick = reg.unregister.bind(this);
                console.log("Registered " + this);
            } else {
                this.release_token();
            }
        }
    },

    unregister : function() {
        if (this.event_source) {
            this.event_source.close();
            this.event_source = null;
        }
        console.log("Unregister " + this);

        if (this.token_refresh) {
            clearInterval(this.token_refresh);
            this.token_refresh = null;
        }

        this.release_token();

        var regunreg = document.getElementById("register");
        regunreg.value = "Register";
        regunreg.className = "green";
        regunreg.onclick = reg.register.bind(this);
    },

    request_token : function() {
        var username = document.getElementById("reg_username").value;
        var password = document.getElementById("reg_password").value;
        var response = this.post_request("request_token", null, username, password);
        var reg_error = document.getElementById("regerror");
        reg_error.innerHTML = "";
        console.log("response " + response["status"]);
        if (response["status"] == 200) {
            this.token = response["data"]["result"]["token"];
            this.registration_uuid = response["data"]["result"]["registration_uuid"];
            var expires = response["data"]["result"]["expires"];
            if (expires === undefined) {
                expires = 120;
            }
            this.token_refresh = setInterval(this.refresh_token.bind(this), (expires * 1000) / 2);
            return true;
        } else if (response["status"] == 401) {
            reg_error.innerHTML = "Failed to register: Unauthorized";
        } else if (response["status"] == 0) {
            reg_error.innerHTML = "Failed to register: " + JSON.stringify(response["data"]);
        } else {
            reg_error.innerHTML = "Failed to register: " + response["status"] + "(" + JSON.stringify(response["data"]) + ")";
        }
        return false;
    },

    refresh_token: function() {
        console.log("refresh_token this " + this);
        var response = this.post_request("refresh_token", null);
        console.log("response " + response["status"]);
        if (response["status"] == 200) {
            this.token = response["data"]["result"]["token"];
        } else {
            console.log("Refresh failed, unregister");
            this.unregister();
            alert("Token refresh failed");
        }
        return false;
    },

    release_token : function() {
        if (this.token) {
            this.post_request("release_token", null);
            this.token = null;
        }
    },

    start_events : function() {
        this.event_source = new EventSource("https://" + this.node + "/api/client/v2/registrations/" + this.alias + "/events?token=" + this.token);
        this.event_source.addEventListener("incoming", reg.incoming.bind(this), false);
        this.event_source.addEventListener("incoming_cancelled", reg.incoming_cancelled.bind(this), false);
        return true;
    },

    incoming : function(event) {
        incoming_data = JSON.parse(event.data);
        console.log("incoming");
        var confirm_string = "Incoming call from:\n" +
                             incoming_data["remote_display_name"] +
                             " ( " + incoming_data["remote_alias"] +
                             " )\nanswer?";
        if (confirm(confirm_string)) {
            // Answer the call
            document.getElementById("conference").value = incoming_data["conference_alias"];
            document.getElementById("worker").value = this.node;
            document.getElementById("pin").value = "";
            user.join_with_token(incoming_data["token"]);
        } else {
            // Reject the call
            this.release_incoming_token(incoming_data['token'], incoming_data['conference_alias']);
        }
    },

    incoming_cancelled : function(event) {
        incoming_data = JSON.parse(event.data);
        console.log("incoming cancelled");
        // TODO better dialog support, so we can close when call is cancelled
    },

    release_incoming_token : function(token, conference) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open("POST", "https://" + this.node + "/api/client/v2/conferences/" + conference + "/release_token", false);
        if (token) {
            xmlhttp.setRequestHeader("token", token);
        }
        try {
            xmlhttp.send();
            console.log("responseText " + xmlhttp.responseText);
            return {"status" : xmlhttp.status, "data" : JSON.parse(xmlhttp.responseText)};
        } catch(exception) {
            console.log("Exception during post_request");
            return {"status" : xmlhttp.status, "data" : {}};
        }
    },

    post_request : function(command, data, username, password) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open("POST", "https://" + this.node + "/api/client/v2/registrations/" + this.alias + "/" + command, false);
        if (this.token) {
            xmlhttp.setRequestHeader("token", this.token);
        }
        var enc = window.btoa(username + ":" + password);
        xmlhttp.setRequestHeader("Authorization", "x-pexip-basic " + enc);
        try {
            if (data) {
                xmlhttp.setRequestHeader("Content-Type", "application/json");
                xmlhttp.send(JSON.stringify(data));
            } else {
                xmlhttp.send();
            }
            console.log("responseText " + xmlhttp.responseText);
            return {"status" : xmlhttp.status, "data" : JSON.parse(xmlhttp.responseText)};
        } catch(exception) {
            console.log("Exception during post_request");
            return {"status" : xmlhttp.status, "data" : {}};
        }
    },

    get_request : function(command) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open("GET", "https://" + this.node + "/api/client/v2/registrations/" + this.alias + "/" + command, false);
        if (this.token) {
            xmlhttp.setRequestHeader("token", this.token);
        }
        try {
            xmlhttp.send();
            console.log("responseText " + xmlhttp.responseText);
            return {"status" : xmlhttp.status, "data" : JSON.parse(xmlhttp.responseText)};
        } catch(exception) {
            console.log("Exception during get_request");
            return {"status" : xmlhttp.status, "data" : {}};
        }
    },

};

var remote_alias_autocomplete = new autoComplete({
            selector: '#remotealias',
            minChars: 1,
            source: function(term, suggest){
                term = term.toLowerCase();
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.open("GET", "https://" + user.node + "/api/client/v2/registrations?q=" + term, false);
                if (user.token) {
                    xmlhttp.setRequestHeader("token", user.token);
                }
                var suggestions = [];
                try {
                    xmlhttp.send();
                    console.log("responseText " + xmlhttp.responseText);
                    result = JSON.parse(xmlhttp.responseText)["result"];
                    for (var i = 0; i < result.length; i++) {
                        suggestions.push(result[i]["alias"]);
                    }

                } catch(exception) {
                    console.log("Exception during get_request");
                }
                suggest(suggestions);
            }
        });



</script>
</body>
